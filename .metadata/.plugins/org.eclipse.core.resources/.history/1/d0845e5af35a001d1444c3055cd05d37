package edu.uco.budget.data.dao.relational.sqlserver;

import java.sql.Connection;
import java.sql.PreparedStatement;
import java.sql.SQLException;
import java.util.ArrayList;
import java.util.List;
import java.util.UUID;

import edu.uco.budget.crosscutting.exception.data.DataCustomException;
import edu.uco.budget.crosscutting.helper.ObjectHelper;
import edu.uco.budget.crosscutting.helper.UUIDHelper;
import edu.uco.budget.crosscutting.messages.Messages;
import edu.uco.budget.data.dao.BudgetDAO;
import edu.uco.budget.data.dao.relational.DAORelational;
import edu.uco.budget.domain.BudgetDTO;

public class BudgetSQLServerDAO extends DAORelational implements BudgetDAO{
	
	public BudgetSQLServerDAO(Connection connection) {
		super(connection);
	}

	@Override
	public final void create(BudgetDTO budget) {
		final var sql = "INSERT INTO Budget(id, idCard, idPerson) VALUES(?, ?, ?)";
		try (final var preparedStatement = getConnection().prepareStatement(sql)){
			preparedStatement.setString(1, budget.getIDAsString());
			preparedStatement.setString(2, budget.getYear().getIdAsString());
			preparedStatement.setString(3, budget.getPerson().getIDAsString());
			
			preparedStatement.executeUpdate();
		} catch (final SQLException exception) {
			throw DataCustomException.CreateTechnicalException(null, exception);
		}catch (final Exception exception) {
			throw DataCustomException.CreateTechnicalException(null, exception);
		}
		}

	@Override
	public List<BudgetDTO> find (final BudgetDTO budget) {
		
		var parameters = new ArrayList<Object>();
        final var sqlBuilder = new StringBuilder();
		
		 createSelectFrom(sqlBuilder);
	     createWhere(sqlBuilder, budget, parameters);
	     createOrderBy(sqlBuilder);

	        return prepareAndExecuteQuery(sqlBuilder, parameters);
		}
		
		return null;
		}

	@Override
	public final void update(final BudgetDTO budget) {
		final var sql = "UPDATE Budget SET year = ?, person = ?";
		try (final PreparedStatement preparedStatement = getConnection().prepareStatement(sql)) {
			preparedStatement.setString(1, budget.getYear().getIDAsString());
			preparedStatement.setString(2, budget.getPerson().getIDAsString());
			preparedStatement.setString(3, budget.getIDAsString());
			
		} catch (Exception exception) {
			// TODO: handle exception
		}
		
	}

	@Override
	public final void delete(final UUID id) {
		// TODO Auto-generated method stub
		
	}

}
